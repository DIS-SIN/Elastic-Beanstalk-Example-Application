{% extends 'layout.html' %}

{% block head %}
	<!-- Highcharts -->
	<script src="https://code.highcharts.com/highcharts.js"></script>
{% endblock head %}

{% block body %}
	<div class="container">
		<h1>{{ pass_dict.course_title }}</h1>
		<div class="row">
			<!-- General Course Info -->
			<div class="col-xs-12">
				<table class="table table-hover">
					<tr>
						<td class="text-center" colspan="3"><h4><strong>{{ _('Course Information and Overall Numbers') }}</strong></h4></td>
					</tr>
					<tr>
						<td><strong>{{ _('Indicator') }}</strong></td>
						<td class="text-center"><strong>{{ LAST_YEAR }}</strong></td>
						<td class="text-center"><strong>{{ THIS_YEAR }}</strong></td>
					</tr>
					{% for tup1, tup2 in pass_dict.general_info_LY|zip(pass_dict.general_info_TY) %}
						<tr>
							<td>{{ tup1[0] }}</td>
							<!-- If offerings remain open in LAST_YEAR, show in red -->
							{% if tup1[0] == _('Open Offerings') and tup1[1] > 0 %}
								<td class="text-center" style="color: red; font-weight: bold;">{{ tup1[1] }}</td>
							{% else %}
								<td class="text-center">{{ tup1[1] }}</td>
							{% endif %}
							<td class="text-center">{{ tup2[1] }}</td>
						</tr>
					{% endfor %}
				</table>
			</div>
			
			<!-- Offerings per Region -->
			<div id="offerings-per-region" class="col-xs-12"></div>
		</div>
		<br/>
		<br/>
		<div class="row">
			
			<!-- Offerings per Language -->
			<div id="offerings-per-lang" class="col-xs-12 col-md-6"></div>
			
			<!-- % of Offerings Cancelled -->
			<div id="offerings-cancelled" class="col-xs-12 col-md-6"></div>
		</div>
		<br/>
		<br/>
		<div class="row">
			
			<!-- Top 5 Departments -->
			<div class="col-xs-12 col-md-6">
				<table class="table table-hover">
					<tr>
						<td class="text-center" colspan="2"><h4><strong>{{ _('Top 5 Departments') }}</strong></h4></td>
					</tr>
					<tr>
						<td><strong>{{ _('Name') }}</strong></td>
						<td class="text-right"><strong>{{ _('Registrations') }}</strong></td>
					</tr>
					{% for tuple in pass_dict.top_5_depts %}
						<tr>
								<td>{{ tuple[0] }}</td>
								<td class="text-right">{{ tuple[1] }}</td>
						</tr>
					{% endfor %}
				</table>
			</div>
			
			<!-- Top 5 Classifications -->
			<div class="col-xs-12 col-md-6">
				<table class="table table-hover">
					<tr>
						<td class="text-center" colspan="2"><h4><strong>{{ _('Top 5 Classifications') }}</strong></h4></td>
					</tr>
					<tr>
						<td><strong>{{ _('Name') }}</strong></td>
						<td class="text-right"><strong>{{ _('Registrations') }}</strong></td>
					</tr>
					{% for tuple in pass_dict.top_5_classifs %}
						<tr>
								<td>{{ tuple[0] }}</td>
								<td class="text-right">{{ tuple[1] }}</td>
						</tr>
					{% endfor %}
				</table>
			</div>
		</div>
		<br/>
		<br/>
		<div class="row">
			
			<!-- Average Class Size -->
			<div id="avg-class-size" class="col-xs-12 col-md-6"></div>
			
			<!-- Average No-Shows per Offering -->
			<div id="avg-no-shows" class="col-xs-12 col-md-6"></div>
		</div>
		<br/>
		<br/>
	</div>
	
	<script>
		// Set font for Highcharts
		Highcharts.setOptions({chart: {style: {fontFamily: 'Helvetica'}}});
		
		function offeringsPerRegion (id) {
			$('#' + String(id)).highcharts({
				chart: {type: 'column'},
				title: {text: "{{ _('Open & Delivered Offerings per Region') }}", style: {fontWeight: 'bold'}},
				xAxis: {categories: ["{{ _('Offerings') }}"]},
				yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
				legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
				credits: {text: ''},
				series: {{ pass_dict.offerings_per_region | safe }}
			});
		};
		function offeringsPerLang (id) {
			$('#' + String(id)).highcharts({
				chart: {type: 'column'},
				title: {text: "{{ _('Open & Delivered Offerings per Language') }}", style: {fontWeight: 'bold'}},
				xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
				yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
				legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
				credits: {text: ''},
				series: [
					{name: "{{ _('English') }}", data: [{{ pass_dict.offerings_per_lang_LY['English'] }}, {{ pass_dict.offerings_per_lang_TY['English'] }}]},
					{name: "{{ _('French') }}", data: [{{ pass_dict.offerings_per_lang_LY['French'] }}, {{ pass_dict.offerings_per_lang_TY['French'] }}]},
					{name: "{{ _('Bilingual') }}", data: [{{ pass_dict.offerings_per_lang_LY['Bilingual'] }}, {{ pass_dict.offerings_per_lang_TY['Bilingual'] }}]}
				]
			});
		};
		function offeringsCancelled (id) {
			$('#' + String(id)).highcharts({
				chart: {type: 'column'},
				title: {text: "{{ _('%% of Offerings Cancelled') }}", style: {fontWeight: 'bold'}},
				xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
				yAxis: {title: {text: ''}, allowDecimals: true,	min: 0,
						labels: {formatter: function() {return String(this.value) + "%";}}},
				tooltip: {
					valueDecimals: 0,
					valuePrefix: '',
					valueSuffix: '%'
				},
				legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
				credits: {text: ''},
				series: [
					{name: "{{ _('Average All') }}", data: [{{ pass_dict.offerings_cancelled_overall_LY }}, {{ pass_dict.offerings_cancelled_overall_TY }}]},
					{name: '{{ pass_dict.course_code }}', data: [{{ pass_dict.offerings_cancelled_LY }}, {{ pass_dict.offerings_cancelled_TY }}]}
				]
			});
		};
		function avgClassSize (id) {
			$('#' + String(id)).highcharts({
				chart: {type: 'column'},
				title: {text: "{{ _('Average Class Size') }}", style: {fontWeight: 'bold'}},
				xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
				yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
				legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
				credits: {text: ''},
				series: [{name: "{{ _('Average All') }}", data: [{{ pass_dict.avg_class_size_overall_LY }}, {{ pass_dict.avg_class_size_overall_TY }}]},
					 	 {name: '{{ pass_dict.course_code }}', data: [{{ pass_dict.avg_class_size_LY }}, {{ pass_dict.avg_class_size_TY }}]}]
			});
		};
		function avgNoShows (id) {
			$('#' + String(id)).highcharts({
				chart: {type: 'column'},
				title: {text: "{{ _('Average No-Shows per Offering') }}", style: {fontWeight: 'bold'}},
				xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
				yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
				legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
				credits: {text: "{{ _('Prepared by Curriculum Management and IPSB') }}"},
				series: [{name: "{{ _('Average All') }}", data: [{{ pass_dict.avg_no_shows_overall_LY }}, {{ pass_dict.avg_no_shows_overall_TY }}]},
					 	 {name: '{{ pass_dict.course_code }}', data: [{{ pass_dict.avg_no_shows_LY }}, {{ pass_dict.avg_no_shows_TY }}]}]
			});
		};
		
		offeringsPerRegion('offerings-per-region');
		offeringsPerLang('offerings-per-lang');
		offeringsCancelled('offerings-cancelled');
		avgClassSize('avg-class-size');
		avgNoShows('avg-no-shows');
		
	</script>
{% endblock body %}
