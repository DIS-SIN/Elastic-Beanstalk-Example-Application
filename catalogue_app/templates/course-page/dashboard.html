<h1>{{ pass_dict.course_title }}</h1>

<div class="row">
	<!-- Overall Numbers-->
	<div class="col-xs-12">
		<table class="table table-hover">
			<tr>
				<td class="text-center" colspan="3"><h4><strong>{{ _('Overall Numbers') }}</strong></h4></td>
			</tr>
			<tr>
				<td><strong>{{ _('Fiscal Year') }}</strong></td>
				<td class="text-center"><strong>{{ LAST_YEAR }}</strong></td>
				<td class="text-center"><strong>{{ THIS_YEAR }}</strong></td>
			</tr>
			{% for tup1, tup2 in pass_dict.overall_numbers_LY|zip(pass_dict.overall_numbers_TY) %}
				<tr>
					<!-- Name -->
					<td>{{ tup1[0] }}</td>
					
					<!-- LAST_YEAR's value -->
					{% if tup1[0] == _('Open Offerings') %}
						<!-- If offerings remain open in LAST_YEAR, show in red -->
						{% if tup1[1] > 0 %}
							<td class="text-center" style="color: red; font-weight: bold;">
								{{ tup1[1] }}
								<img id="open-offerings-tooltip" class="table-tooltip" src="{{ url_for('static', filename='stars/tooltip.png') }}" alt="Tooltip" width="20" />
							</td>
						{% else %}
							<td class="text-center">
								{{ tup1[1] }}
								<img id="open-offerings-tooltip" class="table-tooltip" src="{{ url_for('static', filename='stars/tooltip.png') }}" alt="Tooltip" width="20" />
							</td>
						{% endif %}
					{% else %}
						<td class="text-center">{{ tup1[1] }}</td>
					{% endif %}
					
					<!-- THIS_YEAR's value -->
					<td class="text-center">{{ tup2[1] }}</td>
				</tr>
			{% endfor %}
		</table>
	</div>
</div>


<div class="row">
	<!-- Offerings per Region -->
	<div id="offerings-per-region" class="col-xs-12"></div>
</div>


<div class="row">
	<!-- Offerings per Language -->
	<div id="offerings-per-lang" class="col-xs-12 col-md-6"></div>
	
	<!-- % of Offerings Cancelled -->
	<div id="offerings-cancelled" class="col-xs-12 col-md-6"></div>
</div>


<div class="row">
	<!-- Top 5 Departments -->
	<div class="col-xs-12 col-md-6">
		<table class="table table-hover">
			<tr>
				<td class="text-center" colspan="2"><h4><strong>{{ _('Top 5 Departments') }}</strong></h4></td>
			</tr>
			<tr>
				<td><strong>{{ _('Name') }}</strong></td>
				<td class="text-right"><strong>{{ _('Registrations') }}</strong></td>
			</tr>
			{% for tuple in pass_dict.top_5_depts %}
				<tr>
					<td>{{ tuple[0] }}</td>
					<td class="text-right">{{ tuple[1] }}</td>
				</tr>
			{% endfor %}
		</table>
	</div>
	
	<!-- Top 5 Classifications -->
	<div class="col-xs-12 col-md-6">
		<table class="table table-hover">
			<tr>
				<td class="text-center" colspan="2"><h4><strong>{{ _('Top 5 Classifications') }}</strong></h4></td>
			</tr>
			<tr>
				<td><strong>{{ _('Name') }}</strong></td>
				<td class="text-right"><strong>{{ _('Registrations') }}</strong></td>
			</tr>
			{% for tuple in pass_dict.top_5_classifs %}
				<tr>
					<td>{{ tuple[0] }}</td>
					<td class="text-right">{{ tuple[1] }}</td>
				</tr>
			{% endfor %}
		</table>
	</div>
</div>


<div class="row">
	<!-- Average Class Size -->
	<div id="avg-class-size" class="col-xs-12 col-md-6"></div>
	
	<!-- Average No-Shows per Offering -->
	<div id="avg-no-shows" class="col-xs-12 col-md-6"></div>
</div>

<script>
	// Add tooltip
	$('#open-offerings-tooltip').tooltip({
		placement: 'right',
		title: '<h5>Note:</h5><p>Past offerings must be closed before Level 1 surveys are sent.</p>',
		animation: true,
		html: true
	});
	
	// Set font for Highcharts
	Highcharts.setOptions({chart: {style: {fontFamily: 'Helvetica'}}});
	
	function offeringsPerRegion(id) {
		$('#' + String(id)).highcharts({
			chart: {type: 'column'},
			title: {text: "{{ _('Open & Delivered Offerings per Region') }}", style: {fontWeight: 'bold'}},
			xAxis: {type: 'category'},
			yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
			legend: {enabled: false},
			credits: {text: ''},
			series: [{
				name: 'Offerings',
				colorByPoint: true,
				data: [
					{name: 'Atlantic', drilldown: 'Atlantic', y: {{ pass_dict.offerings_per_region['Atlantic'] }} },
					{name: 'NCR', drilldown: 'NCR', y: {{ pass_dict.offerings_per_region['NCR'] }} },
					{name: 'Ontario', drilldown: 'Ontario', y: {{ pass_dict.offerings_per_region['Ontario'] }} },
					{name: 'Pacific', drilldown: 'Pacific', y: {{ pass_dict.offerings_per_region['Pacific'] }} },
					{name: 'Prairie', drilldown: 'Prairie', y: {{ pass_dict.offerings_per_region['Prairie'] }} },
					{name: 'Québec', drilldown: 'Québec', y: {{ pass_dict.offerings_per_region['Québec'] }} },
					{name: 'Outside Canada', drilldown: 'Outside Canada', y: {{ pass_dict.offerings_per_region['Outside Canada'] }} }
				]
			}],
			drilldown: {
				series: [
					{name: 'Atlantic', id: 'Atlantic', data: {{ pass_dict.province_drilldown['Atlantic'] | safe }} },
					{name: 'NCR', id: 'NCR', data: {{ pass_dict.province_drilldown['NCR'] | safe }} },
					{name: 'Ontario', id: 'Ontario', data: {{ pass_dict.province_drilldown['Ontario'] | safe }} },
					{name: 'Pacific', id: 'Pacific', data: {{ pass_dict.province_drilldown['Pacific'] | safe }} },
					{name: 'Prairie', id: 'Prairie', data: {{ pass_dict.province_drilldown['Prairie'] | safe }} },
					{name: 'Québec', id: 'Québec', data: {{ pass_dict.province_drilldown['Québec'] | safe }} },
					{name: 'Outside Canada', id: 'Outside Canada', data: {{ pass_dict.province_drilldown['Outside Canada'] | safe }} },
				]
			}
		});
	}
	function offeringsPerLang(id) {
		$('#' + String(id)).highcharts({
			chart: {type: 'column'},
			title: {text: "{{ _('Open & Delivered Offerings per Language') }}", style: {fontWeight: 'bold'}},
			xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
			yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
			legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
			credits: {text: ''},
			series: [
				{name: "{{ _('English') }}", data: [{{ pass_dict.offerings_per_lang_LY['English'] }}, {{ pass_dict.offerings_per_lang_TY['English'] }}]},
				{name: "{{ _('French') }}", data: [{{ pass_dict.offerings_per_lang_LY['French'] }}, {{ pass_dict.offerings_per_lang_TY['French'] }}]},
				{name: "{{ _('Bilingual') }}", data: [{{ pass_dict.offerings_per_lang_LY['Bilingual'] }}, {{ pass_dict.offerings_per_lang_TY['Bilingual'] }}]}
			]
		});
	}
	function offeringsCancelled(id) {
		$('#' + String(id)).highcharts({
			chart: {type: 'column'},
			title: {text: "{{ _('%% of Offerings Cancelled') }}", style: {fontWeight: 'bold'}},
			xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
			yAxis: {title: {text: ''}, allowDecimals: true,	min: 0,
					labels: {formatter: function() {return String(this.value) + "%";}}},
			tooltip: {
				valueDecimals: 0,
				valuePrefix: '',
				valueSuffix: '%'
			},
			legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
			credits: {text: ''},
			series: [
				{name: "{{ _('Average All') }}", data: [{{ pass_dict.offerings_cancelled_global_LY }}, {{ pass_dict.offerings_cancelled_global_TY }}]},
				{name: '{{ pass_dict.course_code }}', data: [{{ pass_dict.offerings_cancelled_LY }}, {{ pass_dict.offerings_cancelled_TY }}]}
			]
		});
	}
	function avgClassSize(id) {
		$('#' + String(id)).highcharts({
			chart: {type: 'column'},
			title: {text: "{{ _('Average Class Size') }}", style: {fontWeight: 'bold'}},
			xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
			yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
			legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
			credits: {text: ''},
			series: [{name: "{{ _('Average All') }}", data: [{{ pass_dict.avg_class_size_global_LY }}, {{ pass_dict.avg_class_size_global_TY }}]},
					 {name: '{{ pass_dict.course_code }}', data: [{{ pass_dict.avg_class_size_LY }}, {{ pass_dict.avg_class_size_TY }}]}]
		});
	}
	function avgNoShows(id) {
		$('#' + String(id)).highcharts({
			chart: {type: 'column'},
			title: {text: "{{ _('Average No-Shows per Offering') }}", style: {fontWeight: 'bold'}},
			xAxis: {categories: ['{{ LAST_YEAR }}', '{{ THIS_YEAR }}']},
			yAxis: {title: {text: ''}, allowDecimals: false, min: 0},
			legend: {layout: 'horizontal', align: 'center', verticalAlign: 'bottom'},
			credits: {text: "{{ _('Prepared by Curriculum Management and IPSB') }}"},
			series: [{name: "{{ _('Average All') }}", data: [{{ pass_dict.avg_no_shows_global_LY }}, {{ pass_dict.avg_no_shows_global_TY }}]},
					 {name: '{{ pass_dict.course_code }}', data: [{{ pass_dict.avg_no_shows_LY }}, {{ pass_dict.avg_no_shows_TY }}]}]
		});
	}
	
	offeringsPerRegion('offerings-per-region');
	offeringsPerLang('offerings-per-lang');
	offeringsCancelled('offerings-cancelled');
	avgClassSize('avg-class-size');
	avgNoShows('avg-no-shows');
</script>
