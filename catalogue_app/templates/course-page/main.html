{% extends 'layout.html' %}

{% block head %}
	<!-- Highcharts -->
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<!-- Highcharts drilldown -->
	<script src="https://code.highcharts.com/modules/drilldown.js" async></script>
{% endblock head %}

{% block body %}
	<div class="container">
		<!-- Tabs -->
		<ul class="nav nav-tabs nav-justified main-tabs">
			<li class="active"><a href="#general">{{ _('General') }}</a></li>
			<li><a href="#dashboard">{{ _('Dashboard') }}</a></li>
			<li><a href="#geodata">{{ _('Maps') }}</a></li>
			<li><a href="#ratings">{{ _('Ratings') }}</a></li>
			<li><a href="#comments">{{ _('Comments') }}</a></li>
			<li><a href="#material">{{ _('P&A') }}</a></li>
		</ul>
		
		<!-- Import custom macro for adding 'Download raw data' button -->
		{% from "includes/_formhelpers.html" import download_raw %}
		
		<!-- Tabs' contents -->
		<!-- General -->
		<section id="general" class="tab-content active">
			{% include 'course-page/general.html' %}
			{{ download_raw(url_for('downloads.download_general', course_code=pass_dict.course_code)) }}
		</section>
		
		<!-- Dashboard -->
		<section id="dashboard" class="tab-content hide">
			{% include 'course-page/dashboard-main.html' %}
			{{ download_raw(url_for('downloads.download_dashboard', course_code=pass_dict.course_code)) }}
		</section>
		
		<!-- Geodata -->
		<section id="geodata" class="tab-content hide">
			{% include 'course-page/geodata.html' %}
			<!-- Dashboard and Maps tabs built from same table -->
			{{ download_raw(url_for('downloads.download_dashboard', course_code=pass_dict.course_code)) }}
		</section>
		
		<!-- Level 1 Ratings -->
		<section id="ratings" class="tab-content hide">
			{% include 'course-page/ratings.html' %}
			{{ download_raw(url_for('downloads.download_ratings', course_code=pass_dict.course_code)) }}
		</section>
		
		<!-- Level 1 Comments -->
		<section id="comments" class="tab-content hide">
			{% include 'course-page/comments.html' %}
			{{ download_raw(url_for('downloads.download_comments', course_code=pass_dict.course_code)) }}
		</section>
		
		<!-- Material i.e. Prep & Admin -->
		<section id="material" class="tab-content hide">
			{% include 'course-page/material.html' %}
		</section>
	</div>
	
	<script async>
		// Activate and deactivate tabs
		$(".main-tabs li").on("click", function() {
			$(".main-tabs li").removeClass("active");
			$(this).addClass("active");
		});
		$(".sub-tabs li").on("click", function() {
			$(".sub-tabs li").removeClass("active");
			$(this).addClass("active");
		});
		
		// Show and hide sections
		$('.main-tabs > li > a').click(function(event) {
			event.preventDefault();
			
			// Hide section that's currently active
			var current_section = $('.main-tabs > li.active > a').attr('href');
			$(current_section).removeClass('active');
			$(current_section).addClass('hide');
			
			// Show section whose tab was just clicked
			var new_section = $(this).attr('href');
			$(new_section).removeClass('hide');
			$(new_section).addClass('active');
		});
		$('.sub-tabs > li > a').click(function(event) {
			event.preventDefault();
			
			// Hide section that's currently active
			var current_section = $('.sub-tabs > li.active > a').attr('href');
			$(current_section).removeClass('active');
			$(current_section).addClass('hide');
			
			// Show section whose tab was just clicked
			var new_section = $(this).attr('href');
			$(new_section).removeClass('hide');
			$(new_section).addClass('active');
		});
		
		// Set font for Highcharts
		Highcharts.setOptions({chart: {style: {fontFamily: 'Helvetica'}}});
	</script>
{% endblock body %}
